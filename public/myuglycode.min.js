(function(){angular.module("TimeWhiz",["ngRoute","ngCookies"])})();(function(){angular.module("TimeWhiz").service("authService",["$http","$window",function(e,r){var t=function(e){r.localStorage["timewhiz-token"]=e};var a=function(){return r.localStorage["timewhiz-token"]};var i=function(r){return e.post("./api/register",r).success(function(e){t(e.token)})};var n=function(r){return e.post("./api/login",r).success(function(e){t(e.token)})};var o=function(){r.localStorage.removeItem("timewhiz-token")};var s=function(){var e=a();if(e){var t=JSON.parse(r.atob(e.split(".")[1]));return t.exp>Date.now()/1e3}else{return false}};var l=function(){if(s()){var e=a();var t=JSON.parse(r.atob(e.split(".")[1]));return{username:t.username,id:t.id}}else{return null}};return{setToken:t,getToken:a,register:i,login:n,logout:o,isLoggedIn:s,currentUser:l}}])})();(function(){angular.module("TimeWhiz").service("brbService",["$http","authService",function(e,r){var t=function(e){var r=new Array;for(var t=0;t<e.length;t++){var a=new Array;for(var i=t+1;i<e.length;i++){if(Date.parse(e[t].startTime)===Date.parse(e[i].startTime)){a.push(e.splice(i,1))}}a.push(e[t]);e[t]=null;r.push(a)}return r};var a=function(e){var r=new Array;for(var t=0;t<e.length;t++){var a={startTime:e[t][0].startTime,duration:0,activities:{pee:false,poo:false,puke:false,makeup:false,escape:false,fetish:false}};tempDur=0;tempActivities={pee:0,poo:0,puke:0,makeup:0,escape:0,fetish:0};for(var i=0;i<e[t].length;i++){tempDur+=e[t][i].duration;if(e[t][i].activities.pee===true){tempActivities.pee++}if(e[t][i].activities.poo===true){tempActivities.poo++}if(e[t][i].activities.puke===true){tempActivities.puke++}if(e[t][i].activities.makeup===true){tempActivities.makeup++}if(e[t][i].activities.escape===true){tempActivities.escape++}if(e[t][i].activities.fetish===true){tempActivities.fetish++}}a.duration=tempDur/e[t].length;if(tempActivities.pee/e[t].length>.5){a.activities.pee=true}if(tempActivities.poo/e[t].length>.5){a.activities.poo=true}if(tempActivities.puke/e[t].length>.5){a.activities.puke=true}if(tempActivities.makeup/e[t].length>.5){a.activities.makeup=true}if(tempActivities.escape/e[t].length>.5){a.activities.escape=true}if(tempActivities.fetish/e[t].length>.5){a.activities.fetish=true}r.push(a)}return r};var i=function(t){return e.get("./api/users/"+t+"/brbs/today",{headers:{Authorization:"Bearer "+r.getToken()}})};var n=function(t){return e.get("./api/users/"+t+"/brbs",{headers:{Authorization:"Bearer "+r.getToken()}})};var o=function(){return e.get("./api/users")};return{sortBrbsForTime:t,avgAllBrbs:a,getWhizardBrbs:n,getTodaysBrbs:i,getAllBrbs:o}}])})();(function(){angular.module("TimeWhiz").controller("homeController",["authService",function(r){var t=this;t.isLoggedIn=function(){return r.isLoggedIn()};t.randomFact=e()}]);var e=function(){var e=["During the average lifetime, we spend 3 years on the toilet!","1 in 5 people get annoyed if the toilet paper roll is facing 'the wrong way'.","70% of house guests snoop through other people's bathroom cabinets & drawers!","Men spend 2.4 minutes longer on the toilet than women.","Elvis Presley, Georgia Lass, and Tywin Lannister all died with toilets.","85% of injuries that happen in the bathroom are from falling into the toilet after the seat was left up."];var r=Math.floor(Math.random()*e.length);return e[r]}})();(function(){angular.module("TimeWhiz").controller("timerController",["$http","$location","authService",function(t,a,i){var n=this;n.bigButton="BRB!";n.brb=e;n.isLoggedIn=function(){return i.isLoggedIn()};n.timer=r;n.timer.checkTimed=function(){if(n.timer.timed===true){return true}else{return false}};n.timer.checkTiming=function(){if(n.timer.timing===true){return true}else{return false}};n.timer.clearTimer=function(){n.timer.timed=false;n.timer.timing=false;n.brb.startTime=undefined;n.brb.endTime=undefined;n.brb.duration=undefined;n.brb.activities.pee=false;n.brb.activities.poo=false;n.brb.activities.puke=false;n.brb.activities.makeup=false;n.brb.activities.escape=false;n.brb.activities.fetish=false};n.buttonPress=function(){if(n.timer.checkTiming()){n.endTimer()}else{n.startTimer()}};n.startTimer=function(){n.brb.startTime=new Date;n.timer.timing=true;n.timer.bigButton="~DONE~"};n.endTimer=function(){n.brb.endTime=new Date;n.timer.timing=false;n.brb.duration=n.calculateBRBDuration();n.timer.timed=true;n.timer.bigButton="BRB!"};n.calculateBRBDuration=function(){return n.brb.endTime.getTime()-n.brb.startTime.getTime()};n.submittable=function(){return i.currentUser()!==null};n.logTime=function(){if(i.currentUser()===null){console.log("You ain't signed in, yo!")}else{n.brb.userRef=i.currentUser().id;t.post("./api/brbs",n.brb,{headers:{Authorization:"Bearer "+i.getToken()}}).success(function(e){n.timer.clearTimer()}).error(function(e){console.log(e)})}}}]);var e={userRef:undefined,startTime:undefined,endTime:undefined,duration:undefined,activities:{poo:false,pee:false,puke:false,makeup:false,escape:false,fetish:false}};var r={bigButton:"BRB!",timing:false,timed:false}})();(function(){angular.module("TimeWhiz").controller("loginController",["$http","$location","authService",function(r,t,a){var i=this;i.user=e;i.pageTo=t.search().page||"/";i.submitForm=function(){if(!i.user.username||!i.user.password){console.log("You didn't fill out all required fields yet. Try again!")}else{i.user.username=i.user.username.toLowerCase();a.login(i.user).error(function(e){console.log(e)}).then(function(){i.resetForm();t.search("page",null);t.path("/")})}};i.resetForm=function(){i.user.username=undefined;i.user.password=undefined}}]);var e={username:undefined,password:undefined}})();(function(){angular.module("TimeWhiz").controller("navController",["authService","$location","$cookies",function(e,r,t){var a=this;a.currentPath=r.path();a.isLoggedIn=function(){return e.isLoggedIn()};a.getUserName=function(){var r="User";if(e.currentUser()!==null){r=e.currentUser().username}return r};a.logout=function(){e.logout();r.path("/")}}])})();(function(){angular.module("TimeWhiz").controller("whizardController",["$http","$location","authService","brbService",function(r,t,a,i){var n=this;n.whizard=e;n.avgBrbs=new Array;n.loggedIn=function(){return a.isLoggedIn()};n.curUser=a.currentUser();if(!n.loggedIn()||n.curUser===null){console.log("You need to Log in or register first");t.search("page",null);t.path("/login")}else{r.get("./api/users/"+n.curUser.id,{headers:{Authorization:"Bearer "+a.getToken()}}).success(function(e){n.whizard.username=e.username;n.whizard.fullname=e.fullname}).error(function(e){console.log(e)})}n.brbsToday=i.getTodaysBrbs(n.curUser.id);i.getWhizardBrbs(n.curUser.id).success(function(e){n.whizard.brbs=e;n.setBrbTimespans()}).error(function(e){console.log(e)});i.getAllBrbs().success(function(e){var r=i.sortBrbsForTime(e);var t=i.avgAllBrbs(r);n.avgBrbs=t;n.setBrbTimespans()}).error(function(e){console.log(e)});n.displayableBrbs={whizard:"sput",avg:"sput"};n.timespan={min:new Date(new Date-30*24*60*60*1e3),max:new Date(new Date+24*60*60*1e3)};n.getBrbTimespans=function(e,r){var t=new Array;for(var a=0;a<r.length;a++){var i=new Date(r[a].startTime);if(i.getTime()>=e.min.getTime()&&i.getTime()<=e.max.getTime()){t.push(r[a])}}return t};n.setBrbTimespans=function(){n.displayableBrbs.whizard=n.getBrbTimespans(n.timespan,n.whizard.brbs);n.displayableBrbs.avg=n.getBrbTimespans(n.timespan,n.avgBrbs)}}]);var e={username:undefined,fullname:undefined,brbs:new Array}})();(function(){angular.module("TimeWhiz").controller("registerController",["$http","$location","authService",function(r,t,a){var i=this;i.newUser=e;i.pageTo=t.search().page||"/";i.submitForm=function(){if(!i.newUser.fullname||!i.newUser.username||!i.newUser.password||!i.newUser.termsAgree){console.log("You didnt fill all required fields yet. Try again!")}else{i.newUser.username=i.newUser.username.toLowerCase();a.register(i.newUser).error(function(e){console.log(e)}).then(function(){i.resetForm();t.search("page",null);t.path("/")})}};i.resetForm=function(){i.newUser.fullname=undefined;i.newUser.username=undefined;i.newUser.password=undefined;i.newUser.termsAgree=false}}]);var e={fullname:undefined,username:undefined,password:undefined,termsAgree:false}})();(function(){angular.module("TimeWhiz").controller("radarChartController",[function(){var e=this;e.todaysBrbs;e.radarBrbs=new Array;e.prepareDataForChart=function(r){var t={pee:0,poo:0,puke:0,makeup:0,escape:0,fetish:0};for(var a=0;a<r.length;a++){if(r[a].activities.pee){t.pee++}if(r[a].activities.poo){t.poo++}if(r[a].activities.puke){t.puke++}if(r[a].activities.makeup){t.makeup++}if(r[a].activities.escape){t.escape++}if(r[a].activities.fetish){t.fetish++}}e.todaysBrbs={total:r.length,activities:t};var i={labels:["Pee","Poo","Sick","Hygiene","Etc.","Fetish"],datasets:[{label:"Preferred Activities Today",backgroundColor:"rgba(255, 170, 0, 0.35)",borderColor:"rgba(255, 170, 0, 1)",pointBackgroundColor:"rgba(112, 112, 16, 0.35)",pointBorderColor:"rgba(112, 112, 16, 1)",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"rgba(179,181,198,1)",data:[t.pee,t.poo,t.puke,t.makeup,t.escape,t.fetish]}]};return i}}])})();(function(){angular.module("TimeWhiz").controller("lineChartController",["brbService",function(e){var r=this;r.chartData;r.calculateDataSet=function(e,r){var t=[{label:"Pee BRBs",data:new Array,borderColor:"rgba(255, 170, 0, 0.75)",backgroundColor:"rgba(0,0,0,0)"},{label:"Poo BRBs",data:new Array,borderColor:"rgba(119, 62, 34, 0.75)",backgroundColor:"rgba(0,0,0,0)"},{label:"Puke/Sick BRBs",data:new Array,borderColor:"rgba(112, 112, 16, 0.75)",backgroundColor:"rgba(0,0,0,0)"},{label:"Makeup/Hygiene BRBs",data:new Array,borderColor:"rgba(153, 204, 255, 0.75)",backgroundColor:"rgba(0,0,0,0)"},{label:"Social Escape BRBs",data:new Array,borderColor:"rgba(51, 102, 102, 0.75)",backgroundColor:"rgba(0,0,0,0)"},{label:"Fetish BRBs",data:new Array,borderColor:"rgba(255, 80, 80, 0.75)",backgroundColor:"rgba(0,0,0,0)"},{label:"Overall BRBS",data:new Array,borderColor:"rgba(128, 128, 128, 0.5)",backgroundColor:"rgba(0,0,0,0)"}];for(lb=0;lb<r.length;lb++){var a=r[lb].toDate();for(var i=0;i<e.length;i++){var n=new Date(e[i].startTime);if(a.toDateString()===n.toDateString()){if(t[6].data[lb]===undefined){t[6].data[lb]=0}t[6].data[lb]++;if(e[i].activities.pee===true){if(t[0].data[lb]===undefined){t[0].data[lb]=1}else{t[0].data[lb]++}}else{if(t[0].data[lb]===undefined){t[0].data[lb]=0}}if(e[i].activities.poo===true){if(t[1].data[lb]===undefined){t[1].data[lb]=1}else{t[1].data[lb]++}}else{if(t[1].data[lb]===undefined){t[1].data[lb]=0}}if(e[i].activities.puke===true){if(t[2].data[lb]===undefined){t[2].data[lb]=1}else{t[2].data[lb]++}}else{if(t[2].data[lb]===undefined){t[2].data[lb]=0}}if(e[i].activities.makeup===true){if(t[3].data[lb]===undefined){t[3].data[lb]=1}else{t[3].data[lb]++}}else{if(t[3].data[lb]===undefined){t[3].data[lb]=0}}if(e[i].activities.escape===true){if(t[4].data[lb]===undefined){t[4].data[lb]=1}else{t[4].data[lb]++}}else{if(t[4].data[lb]===undefined){t[4].data[lb]=0}}if(e[i].activities.fetish===true){if(t[5].data[lb]===undefined){t[5].data[lb]=1}else{t[5].data[lb]++}}else{if(t[5].data[lb]===undefined){t[5].data[lb]=0}}}}}return t};r.calculateTimeSet=function(e){var r=new Array;for(var t=0;t<e.length;t++){var a=new Date(e[t].startTime);if(r.length<=0){r.push(a)}var i=false;for(var n=0;n<r.length;n++){if(r[n].toDateString()===a.toDateString()){i=true}if(n+1>=r.length&&i!==true){r.push(a)}}}for(var n=0;n<r.length;n++){r[n]=moment(r[n])}return r};r.prepareBrbsForChart=function(e){var t={labels:new Array,datasets:[]};if(e instanceof Array&&e.length>0){t.labels=r.calculateTimeSet(e);t.datasets=r.calculateDataSet(e,t.labels)}return t};r.chartOptions={scales:{xAxes:[{type:"time",unit:"day",unitStepSize:1,time:{displayFormats:{day:"DD MMM 'YY"}}}]}}}])})();(function(){angular.module("TimeWhiz").controller("barChartController",["brbService",function(e){var r=this;r.chartDataSets=new Array;r.averageDurationsForChart=function(e){var r={overall:{duration:0,count:0,avg:0},pee:{duration:0,count:0,avg:0},poo:{duration:0,count:0,avg:0},puke:{duration:0,count:0,avg:0},makeup:{duration:0,count:0,avg:0},escape:{duration:0,count:0,avg:0},fetish:{duration:0,count:0,avg:0}};for(var t=0;t<e.length;t++){r.overall.duration+=e[t].duration;r.overall.count++;if(e[t].activities.pee===true){r.pee.duration+=e[t].duration;r.pee.count++}if(e[t].activities.poo===true){r.poo.duration+=e[t].duration;r.poo.count++}if(e[t].activities.puke===true){r.puke.duration+=e[t].duration;r.puke.count++}if(e[t].activities.makeup===true){r.makeup.duration+=e[t].duration;r.makeup.count++}if(e[t].activities.escape===true){r.escape.duration+=e[t].duration;r.escape.count++}if(e[t].activities.fetish===true){r.fetish.duration+=e[t].duration;r.fetish.count++}}if(r.pee.count>0){r.pee.avg=r.pee.duration/r.pee.count/(60*1e3)}if(r.poo.count>0){r.poo.avg=r.poo.duration/r.poo.count/(60*1e3)}if(r.puke.count>0){r.puke.avg=r.puke.duration/r.puke.count/(60*1e3)}if(r.makeup.count>0){r.makeup.avg=r.makeup.duration/r.makeup.count/(60*1e3)}if(r.escape.count>0){r.escape.avg=r.escape.duration/r.escape.count/(60*1e3)}if(r.fetish.count>0){r.fetish.avg=r.fetish.duration/r.fetish.count/(60*1e3)}if(r.overall.count>0){r.overall.avg=r.overall.duration/r.overall.count/(60*1e3)}return[r.overall.avg,r.pee.avg,r.poo.avg,r.puke.avg,r.makeup.avg,r.escape.avg,r.fetish.avg]};r.chartLabels=["Overall BRBs","Pee BRBs","Poo BRBs","Sick BRBs","Hygiene BRBs","Etc. BRBs","Fetish BRBs"];r.formatDataForChart=function(e,t,a){var i={label:e,data:new Array,backgroundColor:a,borderColor:a,borderWidth:5};if(t instanceof Array&&t.length>0){i.data=r.averageDurationsForChart(t)}return i}}])})();(function(){angular.module("TimeWhiz").directive("timer",function(){return{templateUrl:"../parts/timer.html",controller:"timerController",controllerAs:"timerCtrl",scope:{},link:function(e,r,t,a){}}})})();(function(){angular.module("TimeWhiz").directive("radarChart",function(){return{restrict:"E",templateUrl:"../parts/radar-chart.html",scope:{getbrbs:"="},controller:"radarChartController",controllerAs:"radarChartCtrl",link:function(e,r,t,a){Chart.defaults.global.responsive=false;var i=r.find("canvas")[0].getContext("2d");var n;var o;e.getbrbs.success(function(e){a.radarBrbs=a.prepareDataForChart(e);o=new Chart(i,{type:"radar",data:a.radarBrbs,options:{scale:{type:"radialLinear",ticks:{stepSize:1,beginAtZero:true}}}})}).error(function(e){console.log(e)})}}})})();(function(){angular.module("TimeWhiz").directive("lineChart",function(){return{restrict:"E",templateUrl:"../parts/line-chart.html",scope:{brbs:"="},controller:"lineChartController",controllerAs:"lineChartCtrl",link:function(e,r,t,a){Chart.defaults.global.responsive=false;var i=r.find("canvas")[0].getContext("2d");var n;e.$watch("brbs",function(r,t){if(r){a.chartData=a.prepareBrbsForChart(e.brbs);n=new Chart(i,{type:"line",data:a.chartData,options:a.chartOptions})}})}}})})();(function(){angular.module("TimeWhiz").directive("barChart",function(){return{restrict:"E",templateUrl:"../parts/bar-chart.html",scope:{whizardbrbs:"=",avgbrbs:"="},controller:"barChartController",controllerAs:"barChartCtrl",link:function(e,r,t,a){Chart.defaults.global.responsive=false;var i=r.find("canvas")[0].getContext("2d");var n;e.$watchGroup(["whizardbrbs","avgbrbs"],function(r,t){if(r){a.chartDataSets=new Array;a.chartDataSets.push(a.formatDataForChart("Your Brbs",e.whizardbrbs,"rgba(255, 170, 0, 1)"));a.chartDataSets.push(a.formatDataForChart("Avg. Brbs",e.avgbrbs,"rgba(112, 112, 16, 0.75)"));n=new Chart(i,{type:"bar",data:{labels:a.chartLabels,datasets:a.chartDataSets},options:{scales:{yAxes:[{type:"linear",beginAtZero:true,stepSize:1}]}}})}})}}})})();(function(){angular.module("TimeWhiz").filter("ratioTime",function(){return function(e){var r=0;var t=0;var a=0;var i=0;for(var n=0;n<=e;n++){r++;if(r>=1e3){t++;r=0}if(t>=60){a++;t=0}if(a>=60){i++;a=0}}return i+":"+a+":"+t+":"+r}}).filter("wordTime",function(){return function(e){var r={msec:0,sec:0,min:0,hr:0};var t="";for(var a=0;a<=e;a++){r.msec++;if(r.msec>=1e3){r.sec++;r.msec=0}if(r.sec>=60){r.min++;r.sec=0}if(r.min>=60){r.hr++;r.min=0}}if(r.hr>0){t+=r.hr+" hours, "}if(r.hr>0&&r.min>0){t+=r.min+" minutes, "}if(r.hr>0||r.min>0||r.sec>0){t+=r.sec+" seconds and "}t+=r.msec+" milliseconds";return t}})})();(function(){var e=function(e,r){e.when("/",{templateUrl:"views/home.html",controller:"homeController",controllerAs:"homeCtrl"}).when("/register",{templateUrl:"views/register.html",controller:"registerController",controllerAs:"registerCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"loginController",controllerAs:"loginCtrl"}).when("/dashboard",{templateUrl:"views/whizard.html",controller:"whizardController",controllerAs:"whizCtrl"}).when("/about",{templateUrl:"views/about.html"}).otherwise({redirectTo:"/"});r.html5Mode(true)};angular.module("TimeWhiz").config(["$routeProvider","$locationProvider",e])})();